<!DOCTYPE html>
<html>
<head>
  <title>Mapa GTA V</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background-color: #0f3157;
    }

    #map {
      width: 100%;
      height: 100vh;
      background-color: #0f3157;
    }
    #counter {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(255,255,255,0.9);
      padding: 8px 12px;
      border-radius: 10px;
      font-family: sans-serif;
      font-weight: bold;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      z-index: 1000;
    }
    #legend {
      position: absolute;
      top: 10px;
      left: 10px;
      max-height: 90vh;
      overflow-y: auto;
      width: 200px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 10px;
      padding: 10px;
      font-family: sans-serif;
      z-index: 1000;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
    }
    #legend h3 {
      margin-top: 0;
      font-size: 16px;
      text-align: center;
    }
    #legend-list {
      list-style: none;
      padding-left: 0;
      margin: 0;
    }
    #legend-list li {
      cursor: pointer;
      padding: 4px 8px;
      margin: 2px 0;
      border-radius: 6px;
      transition: background 0.2s;
    }
    #legend-list li:hover {
      background-color: #eee;
    }
    /* Lightbox (powiększanie zdjęć) */
    #lightbox {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }

    #lightbox img {
      max-width: 90%;
      max-height: 90%;
      border-radius: 10px;
      box-shadow: 0 0 10px #000;
    }

    #lightboxClose {
      position: absolute;
      top: 30px;
      right: 40px;
      color: white;
      font-size: 32px;
      cursor: pointer;
      font-family: sans-serif;
    }
  </style>
</head>
<body>
  <div id="counter">Liczba dilerów: 0</div>
  <div id="map"></div>
  <div id="legend">
    <h3>Dilerzy</h3>
    <ul id="legend-list"></ul>
  </div>
  <!-- Lightbox -->
  <div id="lightbox">
    <div id="lightboxClose">&times;</div>
    <img id="lightboxImage" src="" alt="Powiększone zdjęcie" />
  </div>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const map = L.map('map', {
      crs: L.CRS.Simple,
      minZoom: -2,
      maxZoom: 2
    });

    const imageBounds = [[0, 0], [2048, 2048]];
    L.imageOverlay('fl-dilur/gta5map.png', imageBounds).addTo(map);
    map.fitBounds(imageBounds);

    const znajdzki = [
      { name: "Vinewood Hills", coords: [730, 929] },
      { name: "Left Highway", coords: [788, 427] },
      { name: "Sad", coords: [427, 750] },
      { name: "Złom", coords: [381, 834], image: "złom.png" },
      { name: "Budowa", coords: [544, 863], image: "budowa.png" },
      { name: "Skatepark", coords: [478, 1062] },
      { name: "El Burro", coords: [373, 1191] },
      { name: "Elektrownia", coords: [915, 1394] },
      { name: "Dinozaur", coords: [1097, 1357], image: "dino.png" },
      { name: "Złom Samolot", coords: [1181, 1326] },
      { name: "Motel Sandy", coords: [1257, 1194] },
      { name: "Skate Sandy", coords: [1281, 1349] },
      { name: "Wagon", coords: [1426, 1423] },
      { name: "Dom O'Neal", coords: [1492, 1334] },
      { name: "Szopa", coords: [1026, 1194], image: "szopa.png" },
      { name: "Tunel Paleto", coords: [1464, 833] },
      { name: "Garaż Kurier", coords: [1704, 891] },
      { name: "Magazyn Cluckin Bell", coords: [1702, 947] },
      { name: "Przyczepa Paleto", coords: [1793, 974] },
      { name: "Jacht", coords: [500, 485] },
      { name: "Lost Sandy", coords: [1267, 901], image: "lost.png" },
      { name: "Hamownia", coords: [1103, 1111], image: "hamownia.png" },
      { name: "Statek Doki", coords: [177, 1144] },
      { name: "Mount Chilliad", coords: [1587, 1012] },
    ];

    document.getElementById('counter').textContent = "Liczba dilerów: " + znajdzki.length;

    const defaultIcon = L.icon({
      iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
    });

    const redIcon = L.icon({
      iconUrl: 'fl-dilur/marker-icon-red.png',
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
      shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
      shadowSize: [41, 41],
      shadowAnchor: [12, 41]
    });

    const markers = [];
    let aktywnyMarker = null;

    znajdzki.forEach((z) => {
      const marker = L.marker(z.coords, { icon: defaultIcon }).addTo(map)
        .bindPopup(`
          <div style="text-align:center;">
            <b>${z.name}</b><br>
            ${z.image ? `<img src="fl-dilur/images/${z.image}" 
                 data-src="fl-dilur/images/${z.image}"
                 class="popup-image" 
                 alt="${z.name}" 
                 style="width: 150px; margin-top: 5px; border-radius: 8px; box-shadow: 0 0 5px rgba(0,0,0,0.3); cursor: zoom-in;" />` : ''}
          </div>
        `);

      markers.push(marker);

      marker.on('click', () => {
        if (aktywnyMarker && aktywnyMarker !== marker) {
          aktywnyMarker.setIcon(defaultIcon);
        }
        marker.setIcon(redIcon);
        aktywnyMarker = marker;
      });

      const li = document.createElement('li');
      li.textContent = z.name;

      li.addEventListener('click', () => {
        map.flyTo(z.coords, map.getZoom(), { duration: 0.5 });
        marker.openPopup();

        if (aktywnyMarker && aktywnyMarker !== marker) {
          aktywnyMarker.setIcon(defaultIcon);
        }

        marker.setIcon(redIcon);
        aktywnyMarker = marker;
      });

      document.getElementById('legend-list').appendChild(li);
    });

    // Obsługa lightboxa
    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('popup-image')) {
        const src = e.target.getAttribute('data-src');
        document.getElementById('lightboxImage').src = src;
        document.getElementById('lightbox').style.display = 'flex';
      }

      if (e.target.id === 'lightbox' || e.target.id === 'lightboxClose') {
        document.getElementById('lightbox').style.display = 'none';
        document.getElementById('lightboxImage').src = '';
      }
    });
  </script>
</body>
</html>
